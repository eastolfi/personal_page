{
  "name": "i18n-node-angular",
  "version": "0.2.0",
  "description": "express routes for i18n-node-angular",
  "main": "i18n-node-routes.js",
  "homepage": "https://github.com/oliversalzburg/i18n-node-angular",
  "author": {
    "name": "Oliver Salzburg"
  },
  "license": "MIT",
  "files": [
    "i18n-node-routes.js"
  ],
  "repository": {
    "type": "git",
    "url": "git://github.com/oliversalzburg/i18n-node-angular.git"
  },
  "keywords": [
    "i18n",
    "i18n-node",
    "angular"
  ],
  "dependencies": {
    "i18n": "~0.4.1"
  },
  "readme": "# i18n-node in an AngularJS application\r\n\r\n## The problem\r\nI have an application that uses Node and express. I use [i18n-node](https://github.com/mashpie/i18n-node) for internationalization.\r\n\r\nOn the frontend, I use AngularJS and I have certain strings (in controllers, services and templates) which I also need to have translated. I could use [angular-translate](https://github.com/PascalPrecht/angular-translate) here, but I would really like to use the same resources which I have already generated with i18n-node on my backend.\r\n\r\n## The solution\r\n\r\n### Quick start\r\nThe solution is available in npm and bower packages for the backend and frontend respectively. So you can just... \r\n\r\n1. ...install them with:\r\n\r\n        npm install i18n-node-angular\r\n        bower install i18n-node-angular\r\n\r\n2. ...register the express extensions:\r\n\r\n        var i18n = require( \"i18n\" );\r\n        var i18nRoutes = require( \"i18n-node-angular\" );\r\n\r\n        // The order of these 4 calls matters!\r\n        app.use( i18n.init );\r\n        app.use( i18nRoutes.getLocale );\r\n\r\n        app.use( app.router );\r\n        i18nRoutes.configure( app );\r\n\r\n3. ...put the locale into the DOM:\r\n \r\n        body(data-language=i18n.getLocale())\r\n\r\n4. ...use the translations in Angular:\r\n        \r\n        // Depend on i18n module\r\n        var yourApp = angular.module( \"yourApp\", [ \"ngRoute\", \"i18n\" ] )\r\n            .config( [ \"$routeProvider\", function( $routeProvider ) {\r\n                $routeProvider.\r\n                    when( \"/\", {\r\n                        templateUrl: \"/partials/index\",\r\n                        controller : IndexController,\r\n                        resolve    : {\r\n                            // Make sure locale was loaded before creating controller \r\n                            \"i18nData\": function( i18n ) { return i18n.ensureLocaleIsLoaded().promise; } \r\n                        }\r\n                      } );\r\n            } )\r\n            .factory( \"MyService\", function( i18n ) {\r\n                // Use i18n service injected into this service.\r\n                console.log( i18n.__( \"My translation phrase\" ) );\r\n            } );\r\n\r\n        function IndexController( i18n ) {\r\n            // Use i18n service injected into this controller.\r\n            console.log( i18n.__( \"My translation phrase\" ) );\r\n        }\r\n         \r\n\r\n### How it works\r\nTo make this approach work, we have to make several changes to the application at hand. The final setup is as follows:\r\n\r\n1. Communicate the locale, which was detected by i18n-node on the backend, to the frontend through the DOM.\r\n2. Establishing express routes that allow for retrieval of translations.\r\n3. Accessing those routes from Angular.\r\n\r\n### Make the users locale known in the DOM\r\nFirst of all, we want to place the locale that was determined by i18n-node into our DOM for easy retrieval later on. Of course, you could detect the locale on the client side, but this approach makes sure that the same locale is used on both the backend *and* the frontend. To do that, we first create a function that we can call when compiling our template.\r\n\r\n    app.use( function( req, res, next ) {\r\n      res.locals.acceptedLanguage = function() {\r\n        return i18n.getLocale.apply( req, arguments );\r\n      };\r\n      next();\r\n    } );\r\n\r\nNow we can use that method in our template. In a jade template it would be as simple as: \r\n\r\n    body(data-language=acceptedLanguage())\r\n\r\n### Add the required express routes\r\n**Note:** You can automatically create these routes through [i18n-node-routes.js](https://github.com/oliversalzburg/i18n-node-angular/blob/master/i18n-node-routes.js), which is available through npm (`npm install i18n-node-angular`).\r\n\r\nWe now define two new routes in our express application. The first route will provide our full i18n-node translation document and the second will translate a single phrase.\r\n\r\n    module.exports = function( app ) {\r\n        app.get( \"/i18n/:locale\",          routes.i18n       );\r\n        app.get( \"/i18n/:locale/:phrase\",  routes.translate  );\r\n    }\r\n\r\nLet's look at the implementation of those routes.\r\n\r\n#### `routes.i18n`\r\nThe content of our translation document can then later be used freely on the frontend. For convenience, we'll also implement a service which we'll check out further below.\r\n\r\n    /**\r\n     * Sends a translation file to the client.\r\n     * @param request\r\n     * @param response\r\n     */\r\n    exports.i18n = function( request, response ) {\r\n      var locale = request.params.locale;\r\n      response.sendfile( \"locales/\" + locale + \".json\" );\r\n    };\r\n\r\n#### `routes.translate`\r\nThe translate route could theoretically be used to dynamically load single translated phrases from the backend. We primarily use it to have previously unknown translation phrases added to our JSON files by i18n-node.  \r\n\r\n    /**\r\n     * Translate a given string and provide the result.\r\n     * @param request\r\n     * @param response\r\n     */\r\n    exports.translate = function( request, response ) {\r\n      var locale = request.params.locale;\r\n      var phrase = request.params.phrase;\r\n      var result = i18n.__( {phrase: phrase, locale: locale} );\r\n      response.send( result );\r\n    };\r\n\r\n### Create an AngularJS service to access the translation\r\n**Note:** You can automatically create the service (and more) through [i18n-node-angular.js](https://github.com/oliversalzburg/i18n-node-angular/blob/master/i18n-node-angular.js), which is available through bower (`bower install i18n-node-angular`).\r\n\r\nWe now create an AngularJS service, named `i18n` with a method to access translations, named `__()`, thus making the usage equivalent to that on the backend.\r\n\r\nSee [`i18n-node-angular.js`](https://github.com/oliversalzburg/i18n-node-angular/blob/master/i18n-node-angular.js) for a complete example.\r\n\r\n### Use the service\r\nWe can now access translations easily, by injecting our `i18n` service.\r\n\r\n    function MyController( i18n ) {\r\n        console.log( i18n.__( \"My translation phrase\" ) );\r\n    }\r\n\r\n    servicesModule.factory( \"MyService\", function( i18n ) {\r\n        console.log( i18n.__( \"My translation phrase\" ) );\r\n    }\r\n\r\nIf a term wasn't translated yet, the service will invoke the `/i18n/locale/phrase` route and cause i18n-node to add it to the translation JSON file.\r\n\r\n### Templates\r\n[`i18n-node-angular.js`](https://github.com/oliversalzburg/i18n-node-angular/blob/master/i18n-node-angular.js) also defines a filter named `i18n`. This filter can be used to translate strings in templates. While a lot of strings that appear in page templates are probably already translated on the backend, strings appearing in templates in directives aren't usually passed through the same channel; this is where we use the filter.\r\n\r\n    angular.module( \"foo\", [])\r\n      .directive( \"bar\", function() {\r\n        return {\r\n          template: \"{{'My translation phrase'|i18n}}\"\r\n        };\r\n      });\r\n\r\n#### Ensuring the locale was loaded\r\nIt is possible that you might invoke `i18n.__` before the translation map was loaded from the server. This will cause an error message to be written to your console, telling you that you need to call `ensureLocaleIsLoaded`.\r\n\r\n\r\n##### Locally\r\n`ensureLocaleIsLoaded` returns a promise. So you can simply wrap the call around your use of `i18n.__` or include the call earlier in your load hierarchy. Whatever suits your needs best.\r\n\r\nAn example would be:\r\n\r\n    function MyController( i18n ) {\r\n        i18n.ensureLocaleIsLoaded().then( function() { \r\n            console.log( i18n.__( \"My translation phrase\" ) ); \r\n        } );\r\n    }\r\n\r\n    servicesModule.factory( \"MyService\", function( i18n ) {\r\n        i18n.ensureLocaleIsLoaded().then( function() { \r\n            console.log( i18n.__( \"My translation phrase\" ) ); \r\n        } );\r\n    }\r\n\r\n##### Globally\r\nAlternatively, you can also [make the controller creation wait for the locale to be loaded](http://stackoverflow.com/questions/16286605/initialize-angularjs-service-with-asynchronous-data). An example of such a configuration with the `i18n` service would be:\r\n\r\n    $routeProvider.\r\n      when( \"/\", {\r\n            templateUrl: \"/partials/index\",\r\n            controller : IndexController,\r\n            resolve    : { \"i18nData\": function( i18n ) { return i18n.ensureLocaleIsLoaded().promise; } }\r\n          } );\r\n\r\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/oliversalzburg/i18n-node-angular/issues"
  },
  "_id": "i18n-node-angular@0.2.0",
  "dist": {
    "shasum": "db164dd8feecdae0d3c21b5bf235f751db2d1c57"
  },
  "_from": "i18n-node-angular@0.2.0",
  "_resolved": "https://registry.npmjs.org/i18n-node-angular/-/i18n-node-angular-0.2.0.tgz"
}
